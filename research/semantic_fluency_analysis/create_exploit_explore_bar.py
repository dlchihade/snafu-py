#!/usr/bin/env python3
"""
Create a clean, publication-style bar figure comparing mean exploitation vs exploration
cosine similarity from output/NATURE_REAL_metrics.csv.
"""

from pathlib import Path
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns


def main() -> None:
    base = Path(__file__).parent
    metrics_path = base / 'output' / 'NATURE_REAL_metrics.csv'
    if not metrics_path.exists():
        raise FileNotFoundError(f"Missing metrics file: {metrics_path}")

    df = pd.read_csv(metrics_path)
    # Drop rows missing key columns
    cols = ['exploitation_intra_mean', 'exploration_intra_mean']
    df = df.dropna(subset=cols)
    n = len(df)
    if n == 0:
        raise ValueError("No rows available after dropping missing values.")

    # Compute mean and 95% CI for both metrics
    stats = []
    for label, col in [('Exploitation', 'exploitation_intra_mean'),
                       ('Exploration', 'exploration_intra_mean')]:
        vals = df[col].to_numpy(dtype=float)
        mu = float(np.mean(vals))
        sd = float(np.std(vals, ddof=1)) if len(vals) > 1 else 0.0
        se = sd / np.sqrt(len(vals)) if len(vals) > 0 else 0.0
        ci95 = 1.96 * se
        stats.append({'label': label, 'mean': mu, 'sd': sd, 'ci95': ci95})

    # Style
    plt.rcParams.update({
        'font.family': 'Arial',
        'font.size': 10,
        'axes.titlesize': 12,
        'axes.labelsize': 11,
        'xtick.labelsize': 10,
        'ytick.labelsize': 10,
        'axes.spines.top': False,
        'axes.spines.right': False,
        'savefig.bbox': 'tight',
        'savefig.dpi': 600,
    })
    colors = {'Exploitation': '#D55E00', 'Exploration': '#0072B2'}  # colorblind-friendly

    # Figure
    fig, ax = plt.subplots(figsize=(4.2, 2.6))
    y = np.arange(len(stats))
    means = [s['mean'] for s in stats]
    ci = [s['ci95'] for s in stats]
    labels = [s['label'] for s in stats]
    bar_colors = [colors[l] for l in labels]

    ax.barh(y, means, xerr=ci, capsize=4, color=bar_colors, height=0.6)
    for yi, m, c in zip(y, means, ci):
        ax.text(m + max(0.01, 0.02 * m), yi, f"{m:.3f}", va='center', ha='left', fontsize=10)

    ax.set_yticks(y, labels)
    ax.set_xlabel('Mean cosine similarity (± 95% CI)')
    ax.set_title('Exploitation vs Exploration (real data)')
    ax.grid(axis='x', alpha=0.25)

    out_dir = base / 'output'
    out_dir.mkdir(parents=True, exist_ok=True)
    out_png = out_dir / 'exploit_explore_bar.png'
    out_pdf = out_dir / 'exploit_explore_bar.pdf'
    fig.savefig(out_png)
    fig.savefig(out_pdf)
    plt.close(fig)
    print(f"✅ Wrote {out_png}\n✅ Wrote {out_pdf}")


if __name__ == '__main__':
    main()


